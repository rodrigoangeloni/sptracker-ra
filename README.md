# sptracker - Suite de Aplicaciones para Assetto Corsa

[![Licencia](https://img.shields.io/badge/Licencia-GPL%20v3-blue.svg)](LICENSE.txt)
[![Python](https://img.shields.io/badge/Python-3.8+-green.svg)](https://python.org)
[![Plataforma](https://img.shields.io/badge/Plataforma-Windows%20%7C%20Linux%20%7C%20ARM-lightgrey.svg)](https://github.com/docwilco/sptracker)

**sptracker** es una suite completa de aplicaciones para [Assetto Corsa](http://www.assettocorsa.net/) que incluye `ptracker` (rastreador personal) y `stracker` (rastreador de servidor). Esta herramienta proporciona an√°lisis avanzado de rendimiento, estad√≠sticas detalladas y funcionalidades mejoradas tanto para jugadores individuales como para administradores de servidores. Con soporte nativo para arquitecturas x86, x64, ARM32 y ARM64.

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Componentes](#-componentes)
- [Requisitos del Sistema](#-requisitos-del-sistema)
- [Instalaci√≥n](#-instalaci√≥n)
- [Construcci√≥n desde el C√≥digo Fuente](#-construcci√≥n-desde-el-c√≥digo-fuente)
- [Uso](#-uso)
- [Configuraci√≥n](#-configuraci√≥n)
- [Desarrollo](#-desarrollo)
- [Versionado](#-versionado)
- [Licencia](#-licencia)
- [Contacto](#-contacto)

## ‚ú® Caracter√≠sticas

### Caracter√≠sticas Principales
- **An√°lisis de rendimiento en tiempo real** - Tiempos de vuelta, deltas y comparaciones
- **Interfaz gr√°fica avanzada** - Widgets personalizables con m√∫ltiples temas
- **Estad√≠sticas completas** - Base de datos de rendimiento y an√°lisis hist√≥rico
- **Soporte multiplataforma** - Windows, Linux, ARM32 y ARM64
- **Interfaz web** - Panel de control basado en navegador para servidores
- **Comunicaci√≥n cliente-servidor** - Protocolo de red optimizado
- **Soporte de base de datos** - SQLite y PostgreSQL
- **Compilaci√≥n con Docker** - Soporte para arquitecturas ARM mediante contenedores

### Funcionalidades Espec√≠ficas
- Comparaci√≥n de vueltas con ghost cars
- Informaci√≥n detallada de combustible y neum√°ticos
- Chat mejorado con filtros
- Sistema de autenticaci√≥n para servidores
- Exportaci√≥n de datos para an√°lisis externos
- Monitoreo de sesiones en tiempo real
- Soporte para m√∫ltiples idiomas

## üîß Componentes

### ptracker (Rastreador Personal)
Aplicaci√≥n del lado del cliente que se ejecuta como complemento dentro de Assetto Corsa:
- **An√°lisis de vueltas**: Comparaci√≥n en tiempo real con mejores tiempos
- **Informaci√≥n de carrera**: Datos de combustible, neum√°ticos y rendimiento
- **Interfaz personalizable**: M√∫ltiples widgets y temas visuales
- **Chat mejorado**: Funcionalidades adicionales de comunicaci√≥n

### stracker (Rastreador de Servidor)
Aplicaci√≥n del lado del servidor para administradores de servidores de Assetto Corsa:
- **Base de datos de estad√≠sticas**: Almacenamiento de datos de todos los jugadores
- **Interfaz web**: Panel de control accesible desde navegador
- **Gesti√≥n de usuarios**: Sistema de autenticaci√≥n y permisos
- **Monitoreo en tiempo real**: Seguimiento de sesiones activas
- **Filtros y moderaci√≥n**: Control de chat y lista de baneos

## üíª Requisitos del Sistema

### Requisitos M√≠nimos
- **Sistema Operativo**: Windows 10+ o Ubuntu 18.04+
- **Arquitecturas Soportadas**: x86, x64, ARM32, ARM64
- **Assetto Corsa**: Instalaci√≥n completa del juego
- **Python**: 3.8 o superior (solo para desarrollo)
- **Memoria RAM**: 4GB m√≠nimo, 8GB recomendado
- **Espacio en disco**: 500MB para instalaci√≥n completa

### Para Desarrollo
- **Python**: 3.8+ con pip y virtualenv
- **Git**: Para control de versiones
- **NSIS**: 3.x para crear instaladores de Windows
- **Docker**: Para compilaci√≥n ARM32/ARM64 (opcional)
- **Entorno Linux**: WSL2, VM o host remoto para compilaci√≥n multiplataforma

## üöÄ Instalaci√≥n

### Instalaci√≥n para Usuarios
1. Descarga la √∫ltima versi√≥n desde la secci√≥n [Releases](https://github.com/docwilco/sptracker/releases)
2. **Para Windows**: Ejecuta el instalador `ptracker-V[version].exe`
3. **Para Linux x86**: Extrae `stracker_linux_x86.tgz`
4. **Para ARM32**: Extrae `stracker_linux_arm32.tgz`
5. **Para ARM64**: Extrae `stracker_linux_arm64.tgz`
6. Sigue las instrucciones del instalador
7. Configura Assetto Corsa para cargar el complemento

### Instalaci√≥n R√°pida (Windows)
```powershell
# Descargar e instalar la √∫ltima versi√≥n
Invoke-WebRequest -Uri "https://github.com/docwilco/sptracker/releases/latest" -OutFile "ptracker-latest.exe"
.\ptracker-latest.exe
```

## üõ†Ô∏è Construcci√≥n desde el C√≥digo Fuente

### Estado Actual del Proyecto (Junio 2025)
üöÄ **RECI√âN RESUELTO**: Se ha solucionado un problema cr√≠tico en el sistema de compilaci√≥n relacionado con la gesti√≥n de entornos virtuales:

- **Problema resuelto**: Error "Acceso denegado" al intentar eliminar el entorno virtual `env/windows` durante la compilaci√≥n
- **Causa**: VS Code y otros IDEs manten√≠an archivos bloqueados en el entorno virtual
- **Soluci√≥n implementada**: Gesti√≥n inteligente de entornos virtuales que reutiliza entornos existentes y funcionales
- **Beneficio**: Compilaciones m√°s r√°pidas y sin conflictos de permisos

‚úÖ **COMPLETAMENTE PROBADO EN WINDOWS**: 
- Sistema de compilaci√≥n funcional al 100%
- Script interactivo `interactive_builder.py` operativo
- Generaci√≥n exitosa de todos los ejecutables (ptracker.exe, stracker.exe, stracker-packager.exe)
- Creaci√≥n de instaladores e archivos de distribuci√≥n

‚úÖ **OBJETIVO ALCANZADO**: Compilaci√≥n para arquitecturas ARM completada
- ‚úÖ ARM64: Completamente implementado y probado (9 de junio de 2025)
- ‚úÖ ARM32: Implementado y disponible
- ‚úÖ Meta lograda: soporte completo para Windows, Linux, ARM32 y ARM64

### Configuraci√≥n del Entorno de Desarrollo
```powershell
# Clonar el repositorio
git clone https://github.com/docwilco/sptracker.git
cd sptracker

# Instalar Python y virtualenv
pip install virtualenv

# Crear archivo de configuraci√≥n
Copy-Item release_settings.py.in release_settings.py
# Editar release_settings.py con tus rutas espec√≠ficas
```

### ‚ö†Ô∏è Notas Importantes para el Desarrollo
1. **Entorno Virtual**: El sistema ahora gestiona autom√°ticamente el entorno virtual `env/windows`
2. **VS Code**: Puedes trabajar con VS Code abierto sin problemas de compilaci√≥n
3. **Permisos**: No es necesario ejecutar como administrador
4. **Reutilizaci√≥n**: Los entornos virtuales se reutilizan si est√°n funcionales, acelerando las compilaciones

### Construcci√≥n Interactiva (Recomendado)
Para facilitar el proceso de construcci√≥n, puedes usar el script interactivo:

```powershell
# Ejecutar el constructor interactivo
python interactive_builder.py
```

El script interactivo te guiar√° paso a paso a trav√©s de:
- **Selecci√≥n de versi√≥n**: Especifica la versi√≥n que quieres construir
- **Opciones de construcci√≥n**: Elige qu√© componentes compilar (ptracker, stracker, o ambos)
- **Configuraci√≥n de plataforma**: Windows, Linux, ARM32, ARM64 o todas las arquitecturas
- **Modo de prueba**: Opci√≥n para probar sin hacer commits git
- **Informaci√≥n detallada**: Muestra informaci√≥n completa de todos los archivos generados

### Construcci√≥n Manual
```powershell
# Construir todas las aplicaciones (todas las arquitecturas)
python create_release.py 5.0.0

# Construir solo ptracker
python create_release.py --ptracker_only 5.1.0

# Construir solo stracker
python create_release.py --stracker_only 5.2.0

# Construir solo para Windows
python create_release.py --windows_only 5.0.0

# Construir solo para Linux
python create_release.py --linux_only 5.0.0

# Construir solo para ARM32
python create_release.py --arm32_only 5.0.0

# Construir solo para ARM64
python create_release.py --arm64_only 5.0.0

# Modo de prueba (sin commit git)
python create_release.py --test_release_process 5.0.0
```

### Archivos Generados
Despu√©s de una construcci√≥n exitosa, encontrar√°s los siguientes archivos:

**En el directorio `versions/`:**
- `ptracker-V[version].exe`: Instalador de Windows para ptracker (cliente)
- `stracker-packager-V[version].exe`: Empaquetador standalone de stracker
- `stracker-V[version].zip`: Paquete completo de stracker (servidor)
  - Incluye `stracker_linux_x86.tgz`: Binario Linux x86
  - Incluye `stracker_linux_arm32.tgz`: Binario Linux ARM32 (si se compil√≥)
  - Incluye `stracker_linux_arm64.tgz`: Binario Linux ARM64 (si se compil√≥)

**En el directorio `dist/`:**
- `ptracker.exe`: Ejecutable de ptracker para desarrollo

**En el directorio `stracker/dist/`:**
- `stracker.exe`: Ejecutable principal del servidor
- `stracker-packager.exe`: Herramienta de empaquetado

### Opciones de Construcci√≥n
- `--test_release_process`: Modo de prueba sin modificaciones git
- `--ptracker_only`: Construir solo el cliente ptracker
- `--stracker_only`: Construir solo el servidor stracker
- `--windows_only`: Solo versiones de Windows
- `--linux_only`: Solo versiones de Linux
- `--arm32_only`: Solo versi√≥n ARM 32 bits (requiere Docker)
- `--arm64_only`: Solo versi√≥n ARM 64 bits (requiere Docker)
- `--stracker_packager_only`: Solo el empaquetador de stracker

### Compilaci√≥n para Arquitecturas ARM

‚úÖ **COMPLETADO**: Para compilar binarios ARM32 y ARM64, el proyecto utiliza Docker con compilaci√≥n cruzada:

```powershell
# Instalar Docker Desktop (Windows) o Docker Engine (Linux)
# Aseg√∫rate de que Docker est√° ejecut√°ndose

# Compilar solo ARM32 (DISPONIBLE)
python create_release.py --arm32_only 5.0.0

# Compilar solo ARM64 (COMPLETADO - 9 de junio de 2025)
python create_release.py --arm64_only 5.0.0

# Usar el script interactivo para seleccionar ARM
python interactive_builder.py
# Selecciona opci√≥n "4. ü§ñ Solo ARM32" o "5. ü¶æ Solo ARM64"
```

**Estado de Desarrollo ARM:**
- ‚úÖ **ARM64**: Completamente implementado y probado (9 de junio de 2025)
- ‚úÖ **ARM32**: Implementado y disponible
- ‚úÖ **Testing**: Completado para ARM64, disponible para ARM32
- ‚úÖ **Objetivo**: Soporte completo multiplataforma ALCANZADO

**Archivos Docker:**
- `Dockerfile.arm32`: Configuraci√≥n para compilaci√≥n ARM 32 bits (DISPONIBLE)
- `Dockerfile.arm64`: Configuraci√≥n para compilaci√≥n ARM 64 bits (COMPLETADO ‚úÖ)
- `create_release_arm32.sh`: Script de build espec√≠fico para ARM32 (DISPONIBLE)
- `create_release_arm64.sh`: Script de build espec√≠fico para ARM64 (COMPLETADO ‚úÖ)

**Prerrequisitos para Compilaci√≥n ARM:**
1. Docker Desktop (Windows) o Docker Engine (Linux)
2. Habilitaci√≥n de emulaci√≥n QEMU para arquitecturas cruzadas
3. Conexi√≥n a internet para descargar im√°genes base de Python ARM

### üè† Continuar Desarrollo en Casa - Gu√≠a de Setup

**SITUACI√ìN ACTUAL**: Proyecto completamente funcional en Windows, listo para expandir a ARM

#### Paso 1: Setup del Entorno
```powershell
# Clonar el repositorio actualizado
git clone https://github.com/docwilco/sptracker.git
cd sptracker

# Configurar release_settings.py
Copy-Item release_settings.py.in release_settings.py
# Editar las rutas seg√∫n tu sistema casero
```

#### Paso 2: Validar Funcionalidad Existente
```powershell
# Probar compilaci√≥n Windows (deber√≠a funcionar inmediatamente)
python interactive_builder.py
# Seleccionar: opci√≥n 2 (Solo ptracker) + modo test
```

#### Paso 3: Preparar Docker para ARM
```powershell
# Instalar Docker Desktop
# Verificar que funciona
docker --version
docker run hello-world

# Habilitar emulaci√≥n ARM (si no est√° habilitada)
docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
```

#### Paso 4: Testing ARM64 (Ya Preparado)
```powershell
# Probar compilaci√≥n ARM64
python create_release.py --arm64_only --test_release_process 0.0.1
```

#### Paso 5: Desarrollar ARM32 (Objetivo Principal)
```powershell
# Testing del nuevo Dockerfile.arm32
docker build -f Dockerfile.arm32 -t sptracker-arm32 .

# Testing del script de build ARM32
python create_release.py --arm32_only --test_release_process 0.0.1
```

#### Archivos Clave Modificados (Ya Pusheados)
- ‚úÖ `create_release.py` - Sistema de entornos virtuales mejorado
- ‚úÖ `README.md` - Documentaci√≥n actualizada (este archivo)
- ‚úÖ `interactive_builder.py` - Script interactivo completo
- üöß `Dockerfile.arm32` - Necesita testing
- üöß `create_release_arm32.sh` - Necesita testing

#### Estado de Testing Pendiente
- [x] **ARM64**: Validado ‚úîÔ∏è (compilaci√≥n Docker y empaquetado funcionan correctamente)
- [ ] **ARM32**: Completar implementaci√≥n y testing
- [ ] **ARM Cross-build**: Probar desde diferentes hosts (Windows/Linux)
- [ ] **Integration Testing**: Verificar que los binarios ARM funcionan
- [ ] **Packaging**: Asegurar que se empaquetan correctamente en stracker-V*.zip

#### Pr√≥ximos Objetivos
1. **Inmediato**: Testing completo de ARM64
2. **Corto plazo**: Finalizar implementaci√≥n ARM32
3. **Mediano plazo**: Testing en hardware ARM real (Raspberry Pi, etc.)
4. **Largo plazo**: CI/CD autom√°tico para todas las arquitecturas

### Gesti√≥n de Versiones
Para facilitar la actualizaci√≥n de versiones, puedes usar el script auxiliar:

```powershell
# Actualizar a una versi√≥n espec√≠fica
python update_version.py 5.1.0

# Incrementar autom√°ticamente la versi√≥n
python update_version.py --increment patch  # 5.0.0 ‚Üí 5.0.1
python update_version.py --increment minor  # 5.0.0 ‚Üí 5.1.0
python update_version.py --increment major  # 5.0.0 ‚Üí 6.0.0

# Luego construir el release
python create_release.py 5.1.0
```

## üìñ Uso

### Configuraci√≥n de ptracker
1. Inicia Assetto Corsa
2. Ve a Configuraci√≥n ‚Üí General ‚Üí UI Modules
3. Activa "ptracker"
4. Configura las opciones seg√∫n tus preferencias

### Configuraci√≥n de stracker (Servidor)
```bash
# Ejecutar stracker en servidor Linux x86
./stracker --help

# Ejecutar stracker en ARM32
./stracker_arm32 --help

# Ejecutar stracker en ARM64
./stracker_arm64 --help

# Generar configuraci√≥n por defecto
./stracker --stracker_ini stracker-default.ini

# Ejecutar con configuraci√≥n espec√≠fica
./stracker --stracker_ini mi-config.ini
```

### Interfaz Web de stracker
- Accede a `http://[servidor]:8080` para ver estad√≠sticas
- Panel de administraci√≥n disponible con credenciales configuradas
- API REST para integraci√≥n con otras aplicaciones

## ‚öôÔ∏è Configuraci√≥n

### Archivos de Configuraci√≥n Principales
- `ptracker.ini`: Configuraci√≥n del cliente ptracker
- `stracker.ini`: Configuraci√≥n del servidor stracker
- `release_settings.py`: Configuraci√≥n de construcci√≥n del proyecto

### Configuraci√≥n de Base de Datos
stracker soporta SQLite (por defecto) y PostgreSQL:

```ini
[DATABASE]
database_type = sqlite3
database_file = stracker.db3

# Para PostgreSQL
# database_type = postgres
# postgres_host = localhost
# postgres_user = stracker
# postgres_pwd = password
# postgres_db = stracker
```

## üë®‚Äçüíª Desarrollo

### Estructura del Proyecto
```
sptracker/
‚îú‚îÄ‚îÄ ptracker_lib/          # Biblioteca principal compartida
‚îú‚îÄ‚îÄ stracker/              # C√≥digo del servidor
‚îú‚îÄ‚îÄ images/                # Recursos gr√°ficos
‚îú‚îÄ‚îÄ sounds/                # Archivos de audio
‚îú‚îÄ‚îÄ icons/                 # Iconos de la interfaz
‚îú‚îÄ‚îÄ www/                   # Documentaci√≥n web
‚îú‚îÄ‚îÄ create_release.py      # Script de construcci√≥n principal
‚îî‚îÄ‚îÄ README.md             # Este archivo
```

### Arquitectura de Software
- **Lenguaje**: Python 3.8+
- **GUI**: PySide6/Qt para interfaces nativas
- **Web**: CherryPy para servidor HTTP
- **Base de datos**: SQLite/PostgreSQL con APSW
- **Empaquetado**: PyInstaller para ejecutables
- **Instaladores**: NSIS para Windows

### Contribuir al Proyecto
1. Fork el repositorio en GitHub
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Realiza tus cambios y a√±ade tests si es necesario
4. Commit tus cambios (`git commit -am 'A√±adir nueva funcionalidad'`)
5. Push a la rama (`git push origin feature/nueva-funcionalidad`)
6. Crea un Pull Request

### Est√°ndares de C√≥digo
- Seguir PEP 8 para estilo de c√≥digo Python
- Documentar funciones y clases importantes
- A√±adir tests para funcionalidades nuevas
- Mantener compatibilidad con Python 3.8+

### Esquema de Versionado
El proyecto utiliza [Semantic Versioning](https://semver.org/) a partir de la versi√≥n **5.0.0**:
- **MAJOR** (5.x.x): Cambios incompatibles en la API o arquitectura
- **MINOR** (x.Y.x): Nuevas funcionalidades manteniendo compatibilidad
- **PATCH** (x.x.Z): Correcciones de bugs y mejoras menores

**Nota**: Las versiones anteriores a 5.0.0 corresponden al desarrollo original de NEYS. La nueva numeraci√≥n (5.0.0+) marca el inicio del mantenimiento comunitario y las mejoras significativas del proyecto.

## üè∑Ô∏è Versionado

### Esquema de Versiones
A partir de la versi√≥n **5.0.0**, sptracker utiliza [Semantic Versioning](https://semver.org/):

- **5.x.x** - Versi√≥n principal (cambios incompatibles)
- **x.Y.x** - Versi√≥n menor (nuevas funcionalidades compatibles)
- **x.x.Z** - Versi√≥n de parche (correcciones de bugs)

### Gesti√≥n de Versiones
El proyecto incluye herramientas para facilitar la gesti√≥n de versiones:

```powershell
# Ver versi√≥n actual
python -c "from version_config import get_version; print(get_version())"

# Actualizar versi√≥n manualmente
python update_version.py 5.2.0

# Incrementar versi√≥n autom√°ticamente
python update_version.py --increment patch   # Correcciones
python update_version.py --increment minor   # Nuevas funcionalidades
python update_version.py --increment major   # Cambios incompatibles
```

### Historial de Versiones y Cambios Recientes

#### Versi√≥n 5.0.1 (Junio 2025) - EN DESARROLLO
üöÄ **Mejoras en el Sistema de Compilaci√≥n**:
- ‚úÖ **RESUELTO**: Problema de permisos con entorno virtual durante compilaci√≥n
- ‚úÖ **NUEVO**: Gesti√≥n inteligente de entornos virtuales (reutilizaci√≥n autom√°tica)
- ‚úÖ **NUEVO**: Script interactivo `interactive_builder.py` para compilaci√≥n guiada
- ‚úÖ **MEJORADO**: Mensajes informativos y manejo de errores en `create_release.py`
- üöß **EN DESARROLLO**: Soporte completo para ARM32 (Docker y scripts preparados)
- ‚úÖ **LISTO**: Soporte para ARM64 (validaci√≥n pendiente)

**Cambios T√©cnicos Implementados**:
- Funci√≥n `is_virtualenv_functional()` en `create_release.py`
- Manejo robusto de `PermissionError` con instrucciones claras
- Eliminaci√≥n de recreaci√≥n innecesaria del entorno virtual
- Mejoras en mensajes de error con sugerencias de soluci√≥n

#### Versi√≥n 5.0.0 (Base)
- **Funcionalidades Core**: ptracker + stracker + stracker-packager
- **Soporte Windows**: Compilaci√≥n y empaquetado completos
- **Soporte Linux**: Binarios x86/x64 funcionales
- **Instaladores**: NSIS para Windows, tarball para Linux

### Releases y Distribuci√≥n
Cada versi√≥n genera los siguientes artefactos en el directorio `versions/`:
- `ptracker-V[version].exe`: Instalador de Windows para ptracker
- `stracker-packager-V[version].exe`: Empaquetador standalone de stracker  
- `stracker-V[version].zip`: Paquete completo de stracker (Windows + Linux)

## üìÑ Licencia

Este proyecto est√° licenciado bajo la **GNU General Public License v3.0**. Ver el archivo [LICENSE.txt](LICENSE.txt) para m√°s detalles.

### Nota sobre la Licencia
Como se indica en la GPL v3, tienes la libertad de:
- Usar el software para cualquier prop√≥sito
- Estudiar y modificar el c√≥digo fuente
- Distribuir copias del software
- Distribuir versiones modificadas

Siempre que respetes los t√©rminos de la licencia, incluyendo mantener el c√≥digo fuente disponible bajo la misma licencia.

## üìû Contacto

### Autores y Mantenedores
- **Autor Original**: NEYS
  - Usuario en [Assetto Corsa Forums](http://www.assettocorsa.net/forum/index.php): `never_eat_yellow_snow1`
  - Usuario en [RaceDepartment](http://www.racedepartment.com/forums/): `Neys`

- **Mantenedor Actual**: DocWilco
  - GitHub: [docwilco](https://github.com/docwilco)
  - Repositorio: [sptracker](https://github.com/docwilco/sptracker)

### Soporte y Comunidad
- **Issues y Bugs**: [GitHub Issues](https://github.com/docwilco/sptracker/issues)
- **Discusiones**: [GitHub Discussions](https://github.com/docwilco/sptracker/discussions)
- **RaceDepartment**: [Hilo oficial del proyecto](https://www.racedepartment.com/threads/sp-tracker_source.157319/)

### Mensaje del Autor Original
> "Si√©ntete libre de usar el proyecto para cualquier prop√≥sito que desees, siempre que respetes la licencia. 
> He dejado de jugar AC recientemente y debido a eso mi inter√©s en los mods de AC tambi√©n ha disminuido. 
> Si quieres hacerte cargo del proyecto, estoy abierto a referenciar el fork en la p√°gina principal 
> aqu√≠ en RD, para que los usuarios sean dirigidos a tu p√°gina."

---

<div align="center">

**¬°Gracias por usar sptracker!** üèÅ

Si este proyecto te ha sido √∫til, considera darle una ‚≠ê en GitHub y compartirlo con la comunidad de Assetto Corsa.

</div>
